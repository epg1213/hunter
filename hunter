#!/usr/bin/sh
cd $(dirname $0)
webapp="$(dirname $0)/venv/bin/python3 $(dirname $0)/main.py"

if [ -z "$1" ]; then
    echo "Usage: hunter start|stop|status"
    exit 1
fi

case $1 in
    "start")
        echo "Starting server..."
        sudo docker start hunter-mysql 2>&1 >/dev/null
        $webapp 2>&1 >/dev/null &
        echo "Done."
        exit 0
        ;;
    "stop")
        echo "Stopping server..."
        sudo docker stop hunter-mysql 2>&1 >/dev/null
        kill $(ps -ax | grep "$webapp" | grep -v grep | awk '{print $1}')
        echo "Done."
        exit 0
        ;;
    "status")
        echo "Status:"
        pscount=$(ps -ax | grep "$webapp" | grep -v grep | wc -l)
        if [ $pscount -eq 0 ]; then
            echo "Stopped"
        else
            echo "Running"
        fi
        exit 0
        ;;
esac

echo "Usage: hunter start|stop|status"
exit 1
;;
